<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinical Dashboard | RISA Labs Decision Support</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #fcfcfd; color: #1a1c1e; line-height: 1.5; }
        .clinical-card { background: white; border: 1px solid #e9eaec; border-radius: 2px; }
        .status-badge { padding: 2px 6px; border-radius: 2px; font-size: 10px; font-weight: 700; text-transform: uppercase; border: 1px solid transparent; }
        .bg-pd { background-color: #fff1f2; color: #9f1239; border-color: #fecdd3; }
        .bg-pr { background-color: #f0fdf4; color: #166534; border-color: #dcfce7; }
        .bg-sd { background-color: #eff6ff; color: #1e40af; border-color: #dbeafe; }
        .bg-cr { background-color: #faf5ff; color: #6b21a8; border-color: #f3e8ff; }
        .bg-baseline { background-color: #f8fafc; color: #475569; border-color: #e2e8f0; }
        .timeline-line { position: absolute; left: 7px; top: 0; bottom: 0; width: 1px; background: #e2e8f0; }
        .next-steps-box { background-color: #eef2ff; border: 1px solid #c7d2fe; border-radius: 4px; }
        .timeline-dot { width: 14px; height: 14px; border-radius: 50%; background: white; border: 2px solid #cbd5e1; position: relative; z-index: 10; }
        .timeline-dot.active { border-color: #4f46e5; background: #4f46e5; }
        .ai-panel { background-color: #f8faff; border: 1px solid #e0e7ff; border-radius: 2px; }
        select { appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 0.5rem center; background-size: 1em; }
    </style>
</head>
<body class="p-6 lg:p-8 max-w-[1400px] mx-auto">

    <!-- 1) PATIENT SELECTOR & HEADER -->
    <div class="flex flex-col md:flex-row md:items-end justify-between mb-6 gap-4 border-b border-slate-100 pb-6">
        <div class="space-y-1">
            <h1 class="text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em]">Clinical Review Interface</h1>
            <div class="flex items-center gap-3">
                <select id="patientSelect" onchange="loadPatient()" class="w-64 p-2 text-sm font-bold border border-slate-200 rounded-sm outline-none focus:border-indigo-500 transition-colors">
                </select>
                <div id="lastVisitAlert" class="bg-indigo-50 border border-indigo-100 px-3 py-1.5 rounded-sm flex items-center gap-2">
                    <i data-lucide="info" class="w-3.5 h-3.5 text-indigo-500"></i>
                    <div id="changeSummary" class="text-[11px] font-semibold text-indigo-800">
                    </div>
                </div>
            </div>
        </div>
        <div class="text-right">
            <p class="text-[10px] font-bold text-red-500 uppercase tracking-tight">“This tool supports clinical review and does not provide medical recommendations.”</p>
        </div>
    </div>

    <!-- 2) TOP SUMMARY CARD -->
    <div id="topSummary" class="clinical-card p-5 mb-8 flex flex-wrap items-center justify-between gap-6 border-l-4 border-l-slate-800">
    </div>

    <div class="grid grid-cols-12 gap-8">
        <!-- LEFT COLUMN -->
        <div class="col-span-12 lg:col-span-8 space-y-8">
            <section class="clinical-card p-6">
                <div class="flex items-center justify-between mb-8">
                    <h2 class="text-xs font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2">
                        <i data-lucide="line-chart" class="w-4 h-4"></i> Longitudinal Disease Course
                    </h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-10 gap-8">
                    <div id="timelineContainer" class="md:col-span-4 space-y-6 relative ml-2">
                        <div class="timeline-line"></div>
                    </div>
                    <div class="md:col-span-6 border-l border-slate-50 pl-4 h-64">
                        <canvas id="biomarkerChart"></canvas>
                    </div>
                </div>
            </section>

            <section class="clinical-card p-6">
                <h2 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-6 flex items-center gap-2">
                    <i data-lucide="database" class="w-4 h-4"></i> Treatment History (By Line)
                </h2>
                <div id="treatmentLines" class="space-y-3"></div>
            </section>

            <section class="clinical-card p-6">
                <h2 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-6 flex items-center gap-2">
                    <i data-lucide="activity" class="w-4 h-4"></i> Labs & Safety Monitor
                </h2>
                <div id="labsGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
            </section>
        </div>

        <!-- RIGHT COLUMN -->
        <div class="col-span-12 lg:col-span-4 space-y-8">
            <section class="ai-panel p-6 border-t-2 border-t-indigo-500">
                <h2 class="text-xs font-black text-indigo-900 uppercase tracking-widest mb-5 flex items-center gap-2">
                    <i data-lucide="sparkles" class="w-3.5 h-3.5 text-indigo-600"></i> AI-Assisted Clinical Summary (For Review Only)
                </h2>
                <ul id="aiSummaryPoints" class="space-y-4 text-[12px] text-slate-700 font-medium"></ul>



                
<div class="next-steps-box p-4 mt-6">
    <div class="flex items-center gap-2 mb-2">
        <i data-lucide="arrow-right-circle" class="w-3.5 h-3.5 text-indigo-600"></i>
        <span class="text-[10px] font-black text-indigo-900 uppercase tracking-widest">Clinical Considerations (Next Steps)</span>
    </div>
    <ul id="aiNextSteps" class="space-y-2 text-[11px] text-indigo-800 font-semibold leading-snug list-disc pl-4">
        <!-- Next steps will be injected here -->
    </ul>
</div>




                
            </section>

            <section class="clinical-card p-6">
                <h2 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-5 flex items-center gap-2">
                    <i data-lucide="dna" class="w-4 h-4"></i> Molecular Profile
                </h2>
                <div id="molecularList" class="space-y-4"></div>
            </section>
        </div>
    </div>

    <script>
        const PATIENTS = [
            {
                ID: "PT-101", Dx: "NSCLC (Adeno)", Stage: "IVA", Age: 62, Sex: "F", Line: 2, PS: "ECOG 1",
                History: ["CEA normalized from 12.5 to 4.2 following L2 transition.", "Primary mass reduced 50% on 2024-12-08 CT."],
                EGFR: "Exon 19 del", ALK: "Negative", KRAS: "Negative", PDL1: "75%", MSI: "MSS", TMB: "8",
                Biology: "Informational: EGFR exon 19 deletion is associated with potential sensitivity to 3rd-generation EGFR TKIs.",
                Treatments: [
                    { line: 1, drug: "Carbo + Pemetrexed", start: "2023-03", end: "2024-05", resp: "SD", stop: "Progression" },
                    { line: 2, drug: "Osimertinib 80mg", start: "2024-07", end: "Current", resp: "PR", stop: "Ongoing" }
                ],
                Timeline: [
                    { date: "2023-03-12", event: "Diagnosis", detail: "Initial T2aN1M0. Adeno confirmed.", status: "Baseline", cea: 2.5 },
                    { date: "2024-05-10", event: "Progression", detail: "New contralateral lung nodules.", status: "PD", cea: 12.5 },
                    { date: "2024-12-08", event: "Response Scan", detail: "Primary mass reduced 4.2cm -> 2.1cm.", status: "PR", cea: 4.2 }
                ],
                Labs: [
                    { name: "AST", val: "58", unit: "U/L", range: "8 - 48", history: [22, 35, 58], trend: "up", status: "abnormal" },
                    { name: "ALT", val: "72", unit: "U/L", range: "7 - 55", history: [28, 42, 72], trend: "up", status: "abnormal" },
                    { name: "Creatinine", val: "1.0", unit: "mg/dL", range: "0.7 - 1.3", history: [0.9, 1.0, 1.0], trend: "stable", status: "normal" }
                ],
                AISummary: [
                    "Stable metastatic course as of 2025-01-05 visit.",
                    "Last imaging (2024-12-08) showed 50% tumor volume reduction (PR).",
                    "Today's labs (2025-01-05) show new AST/ALT elevation above ref range.",
                    "Longitudinal CEA trend is downward (12.5 -> 4.2) correlating with response.",
                    "Molecular profile (EGFR del19) matches current targeted therapy logic.",
                    "Performance status stable at ECOG 1 with reported G2 diarrhea."
                ]
            },
            {
                ID: "PT-102", Dx: "NSCLC (Squamous)", Stage: "IVB", Age: 64, Sex: "M", Line: 1, PS: "ECOG 2",
                History: ["Stable clinical state sustained for 14 months.", "Gradual decline in renal markers identified."],
                EGFR: "Negative", ALK: "Negative", KRAS: "G12C", PDL1: "90%", MSI: "MSS",
                Biology: "Informational: High PD-L1 (90%) is a biological indicator associated with Pembrolizumab response.",
                Treatments: [
                    { line: 1, drug: "Pembrolizumab q3w", start: "2023-01", end: "Current", resp: "SD", stop: "Ongoing" }
                ],
                Timeline: [
                    { date: "2022-11-18", event: "Diagnosis", detail: "Stage IIIA. Surgery deferred.", status: "Baseline", cea: 8.0 },
                    { date: "2023-01-05", event: "Metastatic Event", detail: "Bone/Adrenal spread.", status: "PD", cea: 11.5 },
                    { date: "2024-12-18", event: "Recent Review", detail: "Stable thoracic burden.", status: "SD", cea: 12.8 }
                ],
                Labs: [
                    { name: "Creatinine", val: "1.2", unit: "mg/dL", range: "0.7 - 1.3", history: [0.9, 1.1, 1.2], trend: "up", status: "normal" },
                    { name: "Hb", val: "9.6", unit: "g/dL", range: "13.5 - 17.5", history: [12.0, 10.5, 9.6], trend: "down", status: "abnormal" },
                    { name: "CEA", val: "12.8", unit: "ng/mL", range: "< 3.0", history: [8.0, 11.5, 12.8], trend: "stable", status: "abnormal" }
                ],
                AISummary: [
                    "Sustained stable disease (SD) on single-agent IO for 23 months.",
                    "Declining hemoglobin (12.0 -> 9.6) noted over multiple visits.",
                    "Creatinine (1.2) is at upper limit of normal; monitor renal clearance.",
                    "CEA trend is plateaued between 11.5 and 12.8 across 2024.",
                    "Imaging (2024-12-18) confirms no new bone metastases or growth.",
                    "Comorbidity Alert: Uncontrolled T2D may mask clinical cancer symptoms."
                ]
            },
            {
                ID: "PT-103", Dx: "NSCLC (Adeno)", Stage: "IVB", Age: 41, Sex: "F", Line: 2, PS: "ECOG 0",
                History: ["Identified CNS progression Dec 2024.", "Lungs remain radiologically stable."],
                ALK: "Positive", EGFR: "Negative", KRAS: "Negative", PDL1: "10%",
                Biology: "Informational: ALK rearrangement is a biological target for CNS-penetrant TKIs like Alectinib.",
                Treatments: [
                    { line: 1, drug: "Crizotinib", start: "2021-08", end: "2024-02", resp: "PR", stop: "CNS Progression" },
                    { line: 2, drug: "Alectinib 600mg BID", start: "2024-03", end: "Current", resp: "PD", stop: "Ongoing" }
                ],
                Timeline: [
                    { date: "2021-08-04", event: "Diagnosis", detail: "Early stage IA adeno.", status: "Baseline", cea: 1.2 },
                    { date: "2024-03-01", event: "Recurrence", detail: "Distal lung/brain spread.", status: "PD", cea: 3.5 },
                    { date: "2025-01-10", event: "Progression", detail: "New 0.8cm brain lesion.", status: "PD", cea: 6.1 }
                ],
                Labs: [
                    { name: "CEA", val: "6.1", unit: "ng/mL", range: "< 3.0", history: [1.2, 3.5, 6.1], trend: "up", status: "abnormal" },
                    { name: "WBC", val: "5.2", unit: "10^3/uL", range: "4.5 - 11.0", history: [4.8, 5.0, 5.2], trend: "stable", status: "normal" },
                    { name: "ALT", val: "28", unit: "U/L", range: "7 - 55", history: [22, 25, 28], trend: "stable", status: "normal" }
                ],
                AISummary: [
                    "Recent CNS progression (2025-01-10 MRI) despite L2 systemic control.",
                    "CEA trend is upwards (3.5 -> 6.1) since recurrence onset.",
                    "Lungs remain stable; progression is isolated to the CNS sanctuary site.",
                    "High performance status (ECOG 0) maintained despite new headache symptoms.",
                    "Data points to Alectinib resistance in the brain compartment.",
                    "Missing: Repeat CSF cytology not performed to date."
                ]
            },
            {
                ID: "PT-104", Dx: "Breast (HER2+)", Stage: "IVB", Age: 48, Sex: "F", Line: 2, PS: "ECOG 1",
                History: ["Hepatic response (PR) confirmed Nov 2024.", "Acute AST/ALT rise after last cycle."],
                HER2: "Positive (3+)", MSI: "MSS", PDL1: "5%",
                Biology: "Informational: HER2 overexpression is associated with sensitivity to HER2-directed antibody-drug conjugates.",
                Treatments: [
                    { line: 1, drug: "THP Regimen", start: "2022-04", end: "2024-04", resp: "SD", stop: "Progression" },
                    { line: 2, drug: "T-DXd (Enhertu)", start: "2024-05", end: "Current", resp: "PR", stop: "Ongoing" }
                ],
                Timeline: [
                    { date: "2022-04-15", event: "Diagnosis", detail: "Metastatic HER2+ breast.", status: "Baseline", cea: 5.5 },
                    { date: "2024-04-20", event: "Progression", detail: "Increased liver burden.", status: "PD", cea: 8.5 },
                    { date: "2024-11-20", event: "Response", detail: "Decreased FDG in liver.", status: "PR", cea: 2.1 }
                ],
                Labs: [
                    { name: "AST", val: "110", unit: "U/L", range: "8 - 48", history: [25, 45, 110], trend: "up", status: "abnormal" },
                    { name: "ALT", val: "125", unit: "U/L", range: "7 - 55", history: [30, 48, 125], trend: "up", status: "abnormal" },
                    { name: "CEA", val: "2.1", unit: "ng/mL", range: "< 3.0", history: [5.5, 8.5, 2.1], trend: "down", status: "normal" }
                ],
                AISummary: [
                    "Partial response (PR) in liver and bone confirmed on 2024-11-20 scans.",
                    "Recent labs (2025-01-10) show acute AST/ALT elevation above ref range.",
                    "Longitudinal biomarker CA 15-3 dropped from 120 to 45 (last updated Nov).",
                    "No new lesions reported since start of Line 2 therapy.",
                    "Conflicting data: Robust radiological response vs. worsening hepatic labs.",
                    "Missing: Recent Brain MRI to rule out CNS spread."
                ]
            },
            {
                ID: "PT-105", Dx: "Breast (TNBC)", Stage: "IV", Age: 38, Sex: "F", Line: 2, PS: "ECOG 1",
                History: ["Treatment failure on 2L Capecitabine Dec 2024.", "Rapid lung progression detected."],
                MSI: "MSS", PDL1: "2%", TMB: "6", PIK3CA: "Mutant",
                Biology: "Informational: Triple Negative phenotype is associated with high recurrence risk and cytotoxic sensitivity.",
                Treatments: [
                    { line: 1, drug: "AC-T Chemo", start: "2023-01", end: "2024-07", resp: "CR", stop: "Completion" },
                    { line: 2, drug: "Capecitabine", start: "2024-08", end: "Current", resp: "PD", stop: "Ongoing" }
                ],
                Timeline: [
                    { date: "2023-01-20", event: "Diagnosis", detail: "Stage IA post-op.", status: "Baseline", cea: 1.0 },
                    { date: "2024-07-15", event: "Recurrence", detail: "Lung and liver spread.", status: "PD", cea: 4.5 },
                    { date: "2024-12-01", event: "Progression", detail: "New lung nodules.", status: "PD", cea: 8.5 }
                ],
                Labs: [
                    { name: "Hb", val: "10.5", unit: "g/dL", range: "12.0 - 15.5", history: [13.2, 11.5, 10.5], trend: "down", status: "abnormal" },
                    { name: "CA 27-29", val: "88", unit: "U/mL", range: "< 38", history: [15, 45, 88], trend: "up", status: "abnormal" },
                    { name: "Albumin", val: "Missing", unit: "g/dL", range: "3.5 - 5.0", history: [], trend: "none", status: "missing" }
                ],
                AISummary: [
                    "Highly aggressive course post-adjuvant chemotherapy completion.",
                    "Radiological failure on 2L Capecitabine within 4 months (2024-12-01 scan).",
                    "CA 27-29 trend spiked from 15 to 88 over the course of 2024.",
                    "PIK3CA mutation identified in ctDNA Dec 2024 may have clinical relevance.",
                    "Ambiguity: Pathology shows TNBC phenotype but lobular features on biopsy.",
                    "Missing: Recent Albumin and Full Metabolic Panel for nutritional review."
                ]
            },
            {
                ID: "PT-106", Dx: "Colorectal (KRAS+)", Stage: "IV", Age: 55, Sex: "M", Line: 1, PS: "ECOG 1",
                History: ["Maintenance stability for 18 months.", "Pending current quarter CT imaging results."],
                KRAS: "G12V", MSI: "MSS", PDL1: "0%", BRAF: "Negative",
                Biology: "Informational: KRAS mutations are associated with intrinsic resistance to anti-EGFR therapies.",
                Treatments: [
                    { line: 1, drug: "FOLFOX + Bev", start: "2023-06", end: "Current", resp: "SD", stop: "Ongoing" }
                ],
                Timeline: [
                    { date: "2023-05-10", event: "Diagnosis", detail: "Stage IIIB Sigmoid CRC.", status: "Baseline", cea: 12.0 },
                    { date: "2023-06-01", event: "Metastasis", detail: "Liver met identified.", status: "PD", cea: 18.2 },
                    { date: "2025-01-02", event: "Review", detail: "Scans overdue/pending.", status: "SD", cea: 15.4 }
                ],
                Labs: [
                    { name: "CEA", val: "15.4", unit: "ng/mL", range: "< 3.0", history: [12, 18, 15.4], trend: "stable", status: "abnormal" },
                    { name: "Plt", val: "180", unit: "10^3/uL", range: "150 - 450", history: [210, 195, 180], trend: "down", status: "normal" },
                    { name: "AST", val: "32", unit: "U/L", range: "8 - 48", history: [30, 31, 32], trend: "stable", status: "normal" }
                ],
                AISummary: [
                    "Long-term stability (18mo) on 1L cytotoxic maintenance regimen.",
                    "CEA markers plateaued at 15.0 - 15.4 ng/mL since Jan 2024.",
                    "Patient reports progressive G2 neuropathy as of Jan 2025.",
                    "Uncertainty: Decision support limited by overdue CT Chest/Abdomen (Pending).",
                    "No clinical evidence of bowel obstruction or new systemic symptoms.",
                    "Molecular logic confirms exclusion of anti-EGFR therapy due to KRAS G12V."
                ]
            },
            {
                ID: "PT-107", Dx: "Colorectal (MSI-H)", Stage: "NED", Age: 32, Sex: "M", Line: 1, PS: "ECOG 0",
                History: ["Complete radiological resolution Jun 2024.", "Sustained NED status as of Jan 2025."],
                MSI: "MSI-H", TMB: "45", KRAS: "Wild Type",
                Biology: "Informational: MSI-High and high TMB are biological drivers associated with exceptional IO response.",
                Treatments: [
                    { line: 1, drug: "Pembrolizumab", start: "2023-12", end: "Current", resp: "CR", stop: "Ongoing" }
                ],
                Timeline: [
                    { date: "2023-11-05", event: "Diagnosis", detail: "Stage IV peritoneal spread.", status: "Baseline", cea: 12.0 },
                    { date: "2024-06-20", event: "Interval Scan", detail: "Resolution of disease.", status: "CR", cea: 1.8 },
                    { date: "2025-01-09", event: "Latest Scan", detail: "NED sustained.", status: "CR", cea: 1.2 }
                ],
                Labs: [
                    { name: "CEA", val: "1.2", unit: "ng/mL", range: "< 3.0", history: [12, 4.5, 1.2], trend: "down", status: "normal" },
                    { name: "WBC", val: "7.2", unit: "10^3/uL", range: "4.5 - 11.0", history: [6.8, 7.0, 7.2], trend: "stable", status: "normal" },
                    { name: "Cr", val: "0.8", unit: "mg/dL", range: "0.7 - 1.3", history: [0.8, 0.9, 0.8], trend: "stable", status: "normal" }
                ],
                AISummary: [
                    "Patient in deep sustained complete response (CR) since Jun 2024.",
                    "CEA normalized (12.0 -> 1.2) within first 3 months of therapy.",
                    "Latest PET/CT (2025-01-09) confirms zero metabolic activity.",
                    "No reported immunotherapy-related adverse events (irAEs) to date.",
                    "Clinical status is optimal (ECOG 0) with no symptomatic disease.",
                    "Current management is transitioning to surveillance-only focus."
                ]
            },
            {
                ID: "PT-108", Dx: "NSCLC (Stage I)", Stage: "IA", Age: 42, Sex: "F", Line: 0, PS: "ECOG 1",
                History: ["Post-op curative resection June 2024.", "Surveillance baseline established."],
                EGFR: "Negative", ALK: "Negative", KRAS: "Negative",
                Biology: "Informational: Early stage disease (T1) without drivers has a favorable surgical prognosis.",
                Treatments: [
                    { line: 0, drug: "RML Lobectomy", start: "2024-06", end: "2024-06", resp: "CR", stop: "Completion" }
                ],
                Timeline: [
                    { date: "2024-06-10", event: "Diagnosis", detail: "Incidental 1.8cm mass.", status: "Baseline", cea: 0.9 },
                    { date: "2024-11-05", event: "Post-op CT", detail: "Clean surgical bed.", status: "CR", cea: 0.8 },
                    { date: "2024-12-15", event: "Follow-up", detail: "Recovering well.", status: "SD", cea: 0.8 }
                ],
                Labs: [
                    { name: "CEA", val: "0.8", unit: "ng/mL", range: "< 3.0", history: [0.9, 0.8, 0.8], trend: "stable", status: "normal" },
                    { name: "Hb", val: "12.0", unit: "g/dL", range: "12.0 - 15.5", history: [13.5, 12.2, 12.0], trend: "stable", status: "normal" },
                    { name: "WBC", val: "Missing", unit: "10^3/uL", range: "4.5 - 11.0", history: [], trend: "none", status: "missing" }
                ],
                AISummary: [
                    "Curative-intent surgery completed with negative margins Jun 2024.",
                    "Surveillance CT (2024-11-05) shows no evidence of recurrence.",
                    "CEA remains at baseline floor levels (< 1.0) post-resection.",
                    "No clinical signs of pulmonary distress or recurrence reported.",
                    "Missing: Latest WBC and electrolyte panel since surgery.",
                    "Patient reports post-surgical fatigue only; ECOG 1 functional."
                ]
            },
            {
                ID: "PT-109", Dx: "Colorectal (Adeno)", Stage: "IVB", Age: 60, Sex: "M", Line: 2, PS: "ECOG 2",
                History: ["Critical CEA spike from 40 to 245 since Sep 2024.", "New bone lesions identified on 2025-01-04 imaging."],
                BRAF: "V600E", KRAS: "WT", MSI: "MSS", PDL1: "15%",
                Biology: "Informational: BRAF V600E mutations are associated with aggressive disease and rapid progression.",
                Treatments: [
                    { line: 1, drug: "FOLFOX", start: "2023-02", end: "2024-09", resp: "PD", stop: "Progression" },
                    { line: 2, drug: "Encorafenib + Cetux", start: "2024-10", end: "Current", resp: "PD", stop: "Radiological Failure" }
                ],
                Timeline: [
                    { date: "2023-02-14", event: "Diagnosis", detail: "Stage IIIB. High CEA.", status: "Baseline", cea: 5.0 },
                    { date: "2024-09-15", event: "1L Failure", detail: "Lung/Liver progression.", status: "PD", cea: 40.0 },
                    { date: "2025-01-04", event: "2L Failure", detail: "CEA spiked to 245. Bone mets.", status: "PD", cea: 245.0 }
                ],
                Labs: [
                    { name: "CEA", val: "245", unit: "ng/mL", range: "< 3.0", history: [5, 40, 245], trend: "up", status: "abnormal" },
                    { name: "Creatinine", val: "1.4", unit: "mg/dL", range: "0.7 - 1.3", history: [0.8, 1.1, 1.4], trend: "up", status: "abnormal" },
                    { name: "Hb", val: "9.2", unit: "g/dL", range: "13.5 - 17.5", history: [12, 10.5, 9.2], trend: "down", status: "abnormal" }
                ],
                AISummary: [
                    "Rapid multi-organ progression failing current 2L targeted therapy.",
                    "Exponential CEA spike (40 -> 245) noted over the last quarter.",
                    "Radiological failure (2025-01-04) confirmed with new skeletal involvement.",
                    "Declining renal function (Cr 1.4) correlates with overall physical decline.",
                    "Anemia is worsening (Hb 9.2), potentially contributing to ECOG 2 status.",
                    "Uncertainty: Disease burden outpaces current therapeutic efficacy."
                ]
            },
            {
                ID: "PT-110", Dx: "Breast (Male ER+)", Stage: "IV", Age: 54, Sex: "M", Line: 1, PS: "ECOG 1",
                History: ["Stable bone lesions on Tamoxifen.", "Hormone receptor status high (ER 95%)."],
                ER: "95%", PR: "80%", HER2: "Negative", MSI: "MSS",
                Biology: "Informational: High ER/PR expression in male breast cancer is associated with hormone-therapy response.",
                Treatments: [
                    { line: 1, drug: "Tamoxifen 20mg", start: "2024-03", end: "Current", resp: "SD", stop: "Ongoing" }
                ],
                Timeline: [
                    { date: "2024-02-10", event: "Diagnosis", detail: "Stage IIB post-op.", status: "Baseline", cea: 2.2 },
                    { date: "2024-10-15", event: "Metastasis", detail: "PET: Rib involvement.", status: "PD", cea: 3.2 },
                    { date: "2025-01-03", event: "Follow-up", detail: "Bone lesion stable.", status: "SD", cea: 3.5 }
                ],
                Labs: [
                    { name: "CEA", val: "3.5", unit: "ng/mL", range: "< 3.0", history: [2.2, 3.2, 3.5], trend: "stable", status: "normal" },
                    { name: "Hb", val: "12.8", unit: "g/dL", range: "13.5 - 17.5", history: [14.0, 13.5, 12.8], trend: "stable", status: "normal" },
                    { name: "PSA", val: "1.2", unit: "ng/mL", range: "< 4.0", history: [1.1, 1.2, 1.2], trend: "stable", status: "normal" }
                ],
                AISummary: [
                    "Clinically stable male breast cancer on 1L hormone therapy.",
                    "Isolated rib lesion (Oct 2024) remains metabolic-quiescent on last PET.",
                    "CEA markers remain within clinical tolerance levels (~3.5).",
                    "Strong ER expression (95%) matches current Tamoxifen sensitivity profile.",
                    "Patient reports manageable hot flashes as a side effect of therapy.",
                    "Imaging confirms no visceral or symptomatic progression today."
                ]
            }
        ];

        let selectedPt = PATIENTS[0];
        let charts = [];

        function loadPatient() {
            const selector = document.getElementById('patientSelect');
            selectedPt = PATIENTS.find(p => p.ID === selector.value);
            renderDashboard();
        }

        function renderDashboard() {
            clearCharts();
            renderHeader();
            renderTimeline();
            renderTreatments();
            renderLabs();
            renderAISummary();
            renderMolecular();
            lucide.createIcons();
        }

        function renderHeader() {
            document.getElementById('changeSummary').innerHTML = selectedPt.History.map(h => `• ${h}`).join('<br>');
            const header = document.getElementById('topSummary');
            header.innerHTML = `
                <div><span class="text-[9px] font-bold text-slate-400 uppercase tracking-widest block mb-1">Status</span><span class="text-sm font-bold text-slate-800">${selectedPt.Age}Y | ${selectedPt.Sex}</span></div>
                <div><span class="text-[9px] font-bold text-slate-400 uppercase tracking-widest block mb-1">Diagnosis</span><span class="text-sm font-bold text-indigo-700">${selectedPt.Dx}</span></div>
                <div><span class="text-[9px] font-bold text-slate-400 uppercase tracking-widest block mb-1">Current Stage</span><span class="text-sm font-bold text-slate-800">Stage ${selectedPt.Stage}</span></div>
                <div><span class="text-[9px] font-bold text-slate-400 uppercase tracking-widest block mb-1">Active Arc</span><span class="text-sm font-bold text-slate-800">Line ${selectedPt.Line}</span></div>
                <div><span class="text-[9px] font-bold text-slate-400 uppercase tracking-widest block mb-1">Functional</span><span class="text-sm font-bold text-emerald-600">${selectedPt.PS}</span></div>
            `;
        }

        function renderTimeline() {
            const list = document.getElementById('timelineContainer');
            list.innerHTML = `<div class="timeline-line"></div>`;
            selectedPt.Timeline.forEach((t, i) => {
                const item = document.createElement('div');
                item.className = "relative pl-10 pb-6";
                item.innerHTML = `
                    <div class="timeline-dot ${i === selectedPt.Timeline.length - 1 ? 'active shadow-[0_0_0_4px_#e0e7ff]' : ''} absolute left-0 top-1"></div>
                    <div class="flex items-center gap-2 mb-1">
                        <span class="text-[10px] font-bold text-slate-500 uppercase tracking-tight">${t.date}</span>
                        <span class="status-badge bg-${t.status.toLowerCase()}">${t.status}</span>
                    </div>
                    <div class="text-xs font-bold text-slate-800">${t.event}</div>
                    <div class="text-[10px] text-slate-400 mt-1 leading-relaxed">${t.detail}</div>
                `;
                list.appendChild(item);
            });
            renderBiomarkerChart();
        }

        function renderBiomarkerChart() {
            const ctx = document.getElementById('biomarkerChart').getContext('2d');
            const plotData = selectedPt.Timeline.filter(t => t.cea !== undefined);
            
            charts.push(new Chart(ctx, {
                type: 'line',
                data: {
                    labels: plotData.map(t => t.date),
                    datasets: [{
                        label: 'CEA (ng/mL)',
                        data: plotData.map(t => t.cea),
                        borderColor: '#4f46e5',
                        borderWidth: 2,
                        tension: 0.3,
                        pointBackgroundColor: '#4f46e5',
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#f1f3f5' }, ticks: { font: { size: 10, weight: '600' } } },
                        x: { grid: { display: false }, ticks: { font: { size: 9, weight: '600' } } }
                    }
                }
            }));
        }

        function renderTreatments() {
            const container = document.getElementById('treatmentLines');
            container.innerHTML = "";
            selectedPt.Treatments.forEach(t => {
                container.innerHTML += `
                    <div class="flex items-start gap-4 p-4 bg-slate-50 rounded-sm border border-slate-100">
                        <div class="text-[9px] font-black bg-slate-800 text-white w-8 h-8 rounded flex flex-col items-center justify-center shrink-0">L${t.line}</div>
                        <div class="flex-1 grid grid-cols-4 gap-4">
                            <div><span class="text-[8px] font-bold text-slate-400 block uppercase mb-1">Regimen</span><span class="text-[11px] font-bold text-slate-800">${t.drug}</span></div>
                            <div><span class="text-[8px] font-bold text-slate-400 block uppercase mb-1">Dates</span><span class="text-[10px] font-medium text-slate-600">${t.start} — ${t.end}</span></div>
                            <div><span class="text-[8px] font-bold text-slate-400 block uppercase mb-1">Response</span><span class="status-badge bg-${t.resp.toLowerCase()}">${t.resp}</span></div>
                            <div><span class="text-[8px] font-bold text-slate-400 block uppercase mb-1">Reason</span><span class="text-[10px] font-medium text-slate-500">${t.stop}</span></div>
                        </div>
                    </div>
                `;
            });
        }

        function renderLabs() {
            const container = document.getElementById('labsGrid');
            container.innerHTML = "";
            selectedPt.Labs.forEach((l, idx) => {
                const canvasId = `sparkline-${idx}`;
                const isAbnormal = l.status === 'abnormal';
                const color = l.trend === 'up' ? '#ef4444' : l.trend === 'down' ? '#10b981' : '#94a3b8';
                
                container.innerHTML += `
                    <div class="p-4 border ${isAbnormal ? 'bg-red-50 border-red-100' : 'bg-white border-slate-100'}">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-[9px] font-bold text-slate-400 uppercase tracking-widest">${l.name}</span>
                            <div class="text-[8px] font-bold text-slate-400">${l.unit}</div>
                        </div>
                        <div class="flex items-end justify-between">
                            <div>
                                <div class="text-lg font-bold ${isAbnormal ? 'text-red-800' : 'text-slate-800'}">${l.val}</div>
                                <div class="text-[9px] text-slate-400 font-medium">Ref: ${l.range}</div>
                            </div>
                            <div class="w-16 h-8"><canvas id="${canvasId}"></canvas></div>
                        </div>
                    </div>
                `;
                
                setTimeout(() => {
                    const c = document.getElementById(canvasId);
                    if (c && l.history.length > 0) {
                        charts.push(new Chart(c.getContext('2d'), {
                            type: 'line',
                            data: { labels: l.history.map((_,i)=>i), datasets: [{ data: l.history, borderColor: color, borderWidth: 1.5, pointRadius: 0, fill: false }] },
                            options: { responsive: true, maintainAspectRatio: false, events: [], plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
                        }));
                    }
                }, 0);
            });
        }

        // function renderAISummary() {
        //     const list = document.getElementById('aiSummaryPoints');
        //     list.innerHTML = selectedPt.AISummary.map(p => `
        //         <li class="flex gap-3 leading-relaxed">
        //             <i data-lucide="chevron-right" class="w-3.5 h-3.5 shrink-0 text-indigo-400 mt-0.5"></i>
        //             <span>${p}</span>
        //         </li>
        //     `).join('');
        // }


        function renderAISummary() {
    // Renders the main summary bullets
    document.getElementById('aiSummaryPoints').innerHTML = selectedPt.AISummary.map(p => 
        `<li class="flex gap-3 leading-relaxed"><i data-lucide="chevron-right" class="w-3.5 h-3.5 shrink-0 text-indigo-400 mt-0.5"></i><span>${p}</span></li>`
    ).join('');

    // Renders the new Next Steps box
    const nextStepsList = document.getElementById('aiNextSteps');
    if (selectedPt.NextSteps) {
        nextStepsList.innerHTML = selectedPt.NextSteps.map(s => `<li>${s}</li>`).join('');
    } else {
        nextStepsList.innerHTML = "<li>No immediate actions identified. Maintain current surveillance.</li>";
    }
}

        function renderMolecular() {
            const container = document.getElementById('molecularList');
            container.innerHTML = "";
            ['EGFR', 'ALK', 'KRAS', 'PDL1', 'MSI', 'TMB', 'ER', 'PR', 'HER2'].forEach(m => {
                if (selectedPt[m]) {
                    container.innerHTML += `<div class="flex justify-between items-center py-2 border-b border-slate-50"><span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">${m}</span><span class="text-[11px] font-bold ${selectedPt[m]!=='Negative' && selectedPt[m]!=='MSS' ? 'text-indigo-600':'text-slate-400'}">${selectedPt[m]}</span></div>`;
                }
            });
            container.innerHTML += `<div class="mt-4 p-4 bg-slate-50 text-[11px] font-medium text-slate-600 border border-slate-100 leading-relaxed italic">${selectedPt.Biology}</div>`;
        }

        function clearCharts() { charts.forEach(c => c.destroy()); charts = []; }

        function init() {
            const selector = document.getElementById('patientSelect');
            PATIENTS.forEach(p => {
                const opt = document.createElement('option');
                opt.value = p.ID; opt.innerText = p.ID; selector.appendChild(opt);
            });
            renderDashboard();
        }

        window.onload = init;
    </script>
</body>
</html>
